<!DOCTYPE html>
<html lang="en">
<head>
  <link rel="icon" href="/img/iconos/salud.png" type="image/png">  
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/perfiles.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.3.2/html2canvas.js"></script>
  <title>Pacientes archivados</title>      
</head>
<body>
  <%- include('./partials/header');%>
  <%- include('./partials/navbarMedico') %>
  <%- include('./partials/footer'); %>

  <div class="container d-flex justify-content-center">
      <div class="card bg-custom-card text-white mt-3" style="border-radius: 1rem;">
        <div class="card-body text-center">
          <h1 class="mb-4 text-center">Pacientes archivados</h1>
          <form class="d-flex align-items-center">
            <input class="form-control me-2 " type="buscar" placeholder="Buscar" aria-label="Buscar" id="buscar">
            <button class="btn btn-dark" type="submit">
              <img src="/img/iconos/lupa.png"width="20" height="20">
            </button>
          </form>
          <br>
          <button type="button" class="btn btn-primary mb-4" id="pdfout" onclick="imprimirContenido()">Descargar lista completa </button>
          <table class="table table-striped">
                <thead>
                  <tr><!--Encabezado-->
                    <th scope="col"></th>
                    <th scope="col" class="cursor" id="nombre-ord">Nombre</th>
                    <th scope="col" class="cursor" id="apellido-ord">Apellidos</th>
                    <th scope="col" class="cursor" id="fecha-ord">Fecha de nacimiento</th>
                    <th scope="col" class="cursor" id="sexo-ord">Género</th>
                    <th scope="col"></th>
                  </tr>
                </thead>
                <tbody id="cuerpoTablaPacientesArchivados" style="vertical-align: middle;">
                  <!--Informacion de la tabla-->
                  <% usuarios.forEach(u => { %>
                    <tr>
                      <td><a type="button" class="btn"  href="/verPaciente/<%=u.id%>"><img src="/img/iconos/ver1.png" width="25" height="25" title="Ver datos"></a></td>
                      <td><%=u.nombre%></td>
                      <td><%=u.apellidos%></td>
                      <td class="busqueda"><%= new Date(u.fecha).toLocaleDateString() %></td>
                      <td class="busqueda"><%=u.sexo%></td>
                      <td><a type="button" class="btn" onclick="confirmarAlta('<%= u.id %>')" title="Dar de alta"><img src="/img/iconos/verificar.png" width="25" height="25" title="Dar de alta"></a></td><!--Boton para dar de alta a un paciente-->
                    </tr>
                  <% });%>
                </tbody>
          </table>
        </div>
      </div>
  </div>
  
  <div class="resto2"></div>

  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script>
    $(document).ready(function() {
      function ordenarTabla(columna) {
        var tbody = $('table tbody');
        tbody.find('tr').sort(function(a, b) {
          return $('td:eq(' + columna + ')', a).text().localeCompare($('td:eq(' + columna + ')', b).text());
        }).appendTo(tbody);
      }

      // Manejador de evento para el clic en la columna de nombre
      $('#nombre-ord').click(function(){
        ordenarTabla(0);
      });
      $('#apellido-ord').click(function(){
        ordenarTabla(1);
      });
      $('#fecha-ord').click(function(){
        ordenarTabla(2);
      });
      $('#sexo-ord').click(function(){
        ordenarTabla(3);
      });
    });
  
    window.jsPDF = window.jspdf.jsPDF;
    function imprimirContenido() {

      // Obtener la tabla de citas HTML
      var maintable = document.getElementById('cuerpoTablaPacientesArchivados');
      var pdfout = document.getElementById('pdfout');

      pdfout.onclick = function () {
        // generamos el PDF, p = portrait, en vertical
        // pt = points, conteo de puntos; y a4 = tamaño del papel
        var doc = new jsPDF('p', 'pt', 'a4');
        var margin = 20;
        var scale = (doc.internal.pageSize.width - margin * 2) / document.body.clientWidth;

        if(window.innerWidth > 768) {
          doc.html(maintable, {
              x:margin,
              y:margin,
              html2canvas:{
                scale: scale,
              },
              callback: function(doc) {
                doc.save('Pacientes archivados.pdf');
              }
          })
        }
      }
    }

    function confirmarAlta(idPaciente) {
      if (confirm("¿Estás seguro de que quieres dar de alta al paciente?")) {
          window.location.href = "/listaPacientesArchivados/" + idPaciente; // Redirige a la página de archivo del paciente si el usuario confirma
      }
    }

  </script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>